# 创意挑战 App（离线本地版 v1）方案说明

> 目标：最小成本尽快上架 App Store，用户无登录即可使用；所有核心数据保存在本地。界面与交互提供“模拟网络加载体验”（骨架屏/下拉刷新/偶发弱网提示），但不依赖真实服务端。

## 1. 产品定位与范围

- 面向普通用户的“每日创意挑战”工具：生成每日主题，支持图片/≤15s 竖屏视频本地投稿，浏览本地作品库并进行点赞收藏，自我激励与勋章达成。
- 不含注册登录、评论、真实社交关系；不进行任何远程数据上传；可选加载“示例内容包”（本地预置），以提升首屏体验。

## 2. 信息架构与导航

- 底部 3 个 Tab：
  - 首页：今日挑战卡片（主题、规则、倒计时），进入挑战详情与投稿入口。
  - 作品：本地作品流（最新/我喜欢），进入作品详情（全屏播放/查看）。
  - 我的：我的投稿（分组/统计）、勋章墙、设置（通知、导出备份、清空数据、隐私与协议）。

## 3. 关键用户流程

1) 新用户 → 打开 App → 同意隐私与协议 → 查看今日挑战 → 从相册选择或相机拍摄 → 本地压缩与保存 → 作品流可见 → 点赞收藏 → 勋章解锁。

2) 老用户 → 首页倒计时提醒（本地通知） → 参与当日挑战或浏览作品 → 下拉刷新（模拟网络） → 继续打卡。

## 4. “模拟网络加载体验”设计（不依赖真实后端）

- 交互元素：
  - 骨架屏（列表/详情骨架）。
  - 下拉刷新与“正在同步...”文案；首次进入等待 300–800ms 的可控延迟；支持“轻微抖动”的随机延迟以提升真实感。
  - 偶发弱网提示（可配置触发概率、默认极低），提供“重试”按钮（本质为本地重新读取）。
  - 空态页与“离线缓存可用”说明（仍不连接网络）。

- 假接口与本地缓存映射（仅约定，不真正发网）：
  - GET /challenges/today → 读取本地数据库 `ChallengeLocal` 的当日记录（若无则生成）。
  - GET /challenges/:id/submissions → 查询本地 `SubmissionLocal` 列表，支持分页参数（在本地做分页切片）。
  - POST /submissions → 媒体文件保存到本地+写库。
  - POST /like → 更新本地 `liked` 字段与计数缓存。
  - GET /badges → 查询本地 `BadgeLocal`。

- 目录与资源：
  - 本地“缓存”根：`Application Support/Media/{YYYY}/{MM}/...`（图片/视频/封面分目录）。
  - 可选“示例内容包”解压至 `Application Support/MockSeed/`，仅用于模拟首屏内容。

## 5. 数据模型（本地 DB）

推荐 Isar（Dart 原生高性能，无需平台层），备选 Drift（SQLite）。

- ChallengeLocal
  - id: String（日期+seed）
  - title: String
  - rules: String
  - startAt, endAt: DateTime
  - seed: int（生成器种子，保证不同设备可复现）
  - createdAt: DateTime

- SubmissionLocal
  - id: String（UUID）
  - challengeId: String
  - type: String（image|video）
  - filePath: String（绝对路径）
  - coverPath: String（图片或视频首帧）
  - width, height: int
  - duration: double（秒，图片为 0）
  - exifShotAt: DateTime?（可空）
  - liked: bool
  - createdAt: DateTime

- BadgeLocal
  - id: String
  - type: String（e.g. streak_3, streak_7, first_video, three_in_row）
  - achievedAt: DateTime

- AppPrefs（键值）
  - firstLaunchAt: DateTime
  - notificationsEnabled: bool
  - mockModeEnabled: bool（是否显示示例内容）
  - theme: String（system|light|dark）

## 6. 媒体管线（离线）

- 图片：
  - 选取/拍摄 → 压缩：长边 ≤ 1920，JPEG 质量 0.7–0.8。
  - 生成缩略图：列表（~320px 宽）与详情（~960px 宽）。

- 视频：
  - 限制 ≤ 15 秒，期望 1080×1920，H.264/AAC，目标码率 ~3–4 Mbps。
  - 提取首帧为封面图。（ffmpeg 或平台能力）
  - 本地保存与占位加载，播放前优先显示首帧。

- 失败重试：前台队列（单任务），失败弹出提示，可重试或放弃。

## 7. 业务规则与校验

- 投稿窗口：仅在挑战进行时可投稿（startAt ≤ now ≤ endAt）。
- 图片/视频规格校验：分辨率、时长（视频）、文件大小上限（图片 ≤ 5 MB；视频 ≤ 30 MB）。
- EXIF 拍摄时间可用于“现场拍摄”可选校验（首版默认非必需）。

## 8. 勋章与统计（本地）

- 勋章类型：
  - 连续 3 天、7 天参赛。
  - 首次视频投稿。
  - 连续 3 个日题完成。

- 统计：
  - 总参赛次数、最近一周活跃天数、最长连续天数。

## 9. 权限与隐私（iOS 侧文案）

- 相机：用于拍摄挑战作品。
- 相册读写：用于选择与保存作品到相册。
- 麦克风：用于录制视频音频。
- 隐私声明：不收集个人数据，所有数据仅存于本机，可在“设置-导出备份”。

## 10. App Store 审核友好策略

- 无登录、无第三方 SDK、无跟踪（ATT 不弹）。
- 首屏与列表具“加载/刷新”体验，但完全可离线使用；空态页与弱网提示均可由本地触发，不依赖网络。
- 提供隐私政策（离线 HTML）与用户协议页面；说明“数据仅存储在本机”。
- 年龄分级：12+（无在线 UGC）。

## 11. 性能与指标（验收）

- 首屏可交互 < 1.5s；作品流首批可交互 < 1.0s。
- 图片保存成功率 ≥ 99%；视频压缩+保存成功率 ≥ 97%。
- 崩溃率 < 0.3%。

## 12. 技术选型与结构

- Flutter 3.x（Dart ≥ 3），状态管理：Riverpod/BLoC（二选一）。
- 本地数据库：Isar（首选）。
- 媒体：图片压缩库 + ffmpeg（或 ffmpeg_kit_flutter）实现转码与首帧提取。
- 本地通知：每日挑战开始/截止提醒（可配置）。
- 目录规范：
  - `Application Support/Media/Images/Original|Thumb|Detail`
  - `Application Support/Media/Videos/Original|Cover`
  - `Application Support/MockSeed/`（示例资源包）

## 13. 里程碑（2–3 周）

- 第 1 周：导航与页面骨架、今日挑战生成器、本地 DB、图片管线（选取/压缩/缩略）。
- 第 2 周：视频管线（转码/首帧/播放）、作品流与详情、本地通知、勋章与统计、设置页（导出/清空）。
- 第 3 周：动效与打磨、文案与多语言占位、自测/灰度、提交审核。

## 14. 需要你提供的素材清单（最低集）

- 品牌与商店素材：
  - App 图标（1024×1024 源文件，设计规范可再细化）。
  - 启动画面背景（建议 2732×2732 可安全居中裁切）。
  - App Store 截图占位图（iPhone 6.7"/6.5"/5.5" 至少各 5 张，后续由我们导出最终版）。

- 应用内展示：
  - 示例作品包（20–50 条，图片与 ≤15s 竖屏视频，若选择开启“示例内容包”）。
  - 隐私政策与用户协议文案（Markdown/HTML 任一）。
  - 品牌色与 Logo（SVG/PNG）。

## 15. 待确认项（拍板后即开工）

1) 投稿形态：首版是否同时支持“图片 + ≤15s 竖屏视频”？若为提速，可仅图片。
2) 是否启用“示例内容包”（本地预置）以充实首屏？默认开启或在设置中开关？
3) 是否提供“自定义挑战”创建入口（除每日挑战外）？
4) 备份是否需要“导入恢复”？首版仅“导出备份”可否接受？

## 16. 风险与对策

- 视频转码耗时：限制时长与码率；转码进度提示与可取消。
- 存储膨胀：设置中提供空间清理与批量删除；媒体与数据库联动删除。
- 首次体验空：若无示例包，首日空态需提供优雅引导与演示。

## 17. 版本演进（展望）

- V1.1：导入恢复、更多勋章、按月回顾海报导出。
- V1.2：协作/接龙（本地共享工程，仍不联网）、更丰富的模板与题库。
- V2.0（可选）：引入轻量云备份与分享（需合规再评估）。

---

如无新增要求，按本说明执行实现；待“待确认项”拍板与素材到位后，可直接启动开发。


